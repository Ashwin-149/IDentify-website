{% extends "base.html" %}
{% block title %}Admin Events Â· IDentify{% endblock %}
{% block content %}
<div class="d-flex align-items-center mb-3">
  <i class="bi bi-gear fs-3 me-2 text-primary"></i>
  <h2 class="m-0">Admin: Events</h2>
</div>

<div class="row g-4">
  <div class="col-12 col-lg-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Create Event</h5>
        <form method="post" action="{{ url_for('admin_create_event') }}" enctype="multipart/form-data">
          <div class="mb-3">
            <label class="form-label">Title<span class="text-danger">*</span></label>
            <input name="title" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea name="description" class="form-control" rows="5"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Start</label>
            <input name="start_at" type="datetime-local" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">End</label>
            <input name="end_at" type="datetime-local" class="form-control">
          </div>

          <div class="mb-3">
            <label class="form-label">Location</label>
            <input name="location" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Capacity (blank = unlimited)</label>
            <input name="capacity" type="number" min="0" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Upload Fliers/Images</label>
            <input name="images" type="file" class="form-control" accept="image/*" multiple>
          </div>
          <div class="mb-3">
            <label class="form-label">Cover image (optional)</label>
            <input class="form-control" type="file" name="cover_file" accept=".png,.jpg,.jpeg,.webp,.gif">
          </div>
          <button type="submit" class="btn btn-primary w-100">Create</button>
        </form>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-8">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">All Events</h5>
        <div class="table-responsive">
          <table class="table table-striped align-middle">
            <thead>
              <tr>
                <th>Title</th>
                <th>Active</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for e in events %}
              <tr>
                <td>{{ e.title }}</td>
                <td>
                  <span class="badge {{ 'bg-success' if e.is_active else 'bg-secondary' }}">
                    {{ 'Yes' if e.is_active else 'No' }}
                  </span>
                </td>
                <td class="text-nowrap">
                  <div class="d-flex align-items-center gap-2 flex-wrap">
                    <a href="{{ url_for('event_detail', slug=e.slug) }}" class="btn btn-outline-primary btn-sm" target="_blank">
                      View
                    </a>

                    <form method="post" action="{{ url_for('admin_toggle_event', event_id=e.id) }}" class="m-0 p-0">
                      <button type="submit" class="btn btn-outline-secondary btn-sm">Toggle</button>
                    </form>

                    <form method="post"
                          action="{{ url_for('admin_delete_event', event_id=e.id) }}"
                          class="m-0 p-0"
                          onsubmit="return confirm('Delete this event and related data? This cannot be undone.');">
                      <button type="submit" class="btn btn-outline-danger btn-sm">Delete</button>
                    </form>
                    <a href="{{ url_for('admin_edit_event_form', event_id=e.id) }}" class="btn btn-outline-warning btn-sm">Edit</a>
                  </div>
                </td>


              </tr>
              {% endfor %}
              {% if events|length == 0 %}
              <tr><td colspan="4" class="text-muted">No events found.</td></tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
