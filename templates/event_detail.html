{% extends "base.html" %}
{% block title %}{{ event.title }} · IDentify{% endblock %}
{% block content %}
<a class="text-decoration-none" href="{{ url_for('events_list') }}">
  <i class="bi bi-arrow-left"></i> Back to Events
</a>

<div class="row mt-3 g-4">
  <div class="col-12 col-lg-7">
    <div class="card shadow-sm">
      {% if event.cover_url %}
      <img src="{{ event.cover_url }}" class="card-img-top" alt="cover">
      {% endif %}
      <div class="card-body">
        <h3 class="card-title">{{ event.title }}</h3>
        <p class="text-muted mb-1">
          <i class="bi bi-calendar-event"></i>
          {{ event.start_pretty }}{% if event.end_pretty %} – {{ event.end_pretty }}{% endif %}
        </p>

        {% if event.location %}
        <p class="text-muted"><i class="bi bi-geo-alt"></i> {{ event.location }}</p>
        {% endif %}
        {% if event.capacity %}
        <p><span class="badge bg-info text-dark">Capacity: {{ registered_count }}/{{ event.capacity }}</span></p>
        {% endif %}
        <hr>
        <div>{{ event.description|safe }}</div>

      </div>
    </div>
  </div>

  <div class="col-12 col-lg-5">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title"><i class="bi bi-pencil-square me-1"></i> Register</h5>
        <form method="post" action="{{ url_for('event_register', slug=event.slug) }}">
          <div class="mb-3">
            <label class="form-label">Registration Number<span class="text-danger">*</span></label>
            <input name="reg_number" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Name</label>
            <input name="name" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input name="email" type="email" class="form-control">
          </div>
          <button type="submit" class="btn btn-primary w-100">Register</button>
        </form>
      </div>
    </div>
    <div>
      {% if current_user.is_authenticated %}
        <hr class="mt-4">
        <div class="d-flex flex-wrap gap-2 mt-2">
          <a class="btn btn-outline-success btn-sm"
             href="{{ url_for('admin_event_registrations', event_id=event.id) }}">
            <i class="bi bi-people"></i> View registrations
          </a>

          <a class="btn btn-outline-primary btn-sm"
             href="{{ url_for('admin_export_regs_csv', event_id=event.id) }}">
            <i class="bi bi-file-earmark-spreadsheet"></i> Export to Excel
          </a>
          <form method="post"
                action="{{ url_for('admin_delete_event_by_slug', slug=event.slug) }}"
                onsubmit="return confirm('Delete this event? This cannot be undone.');">
            <button type="submit" class="btn btn-outline-danger btn-sm">
              <i class="bi bi-trash"></i> Delete Event
            </button>
          </form>
        </div>

      {% endif %}
    </div>

  </div>
</div>
{% endblock %}
