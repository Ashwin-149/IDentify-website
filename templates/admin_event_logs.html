{% extends "base.html" %}
{% block title %}{{ event.title }} – Event Logs{% endblock %}

{% block content %}
<div class="d-flex align-items-center mb-3">
  <h1 class="h4 mb-0">{{ event.title }} – Event Logs</h1>
  <span class="ms-3 text-muted">ID {{ event.id }}</span>
</div>

<div class="d-flex gap-2 mb-3">
  <a class="btn btn-outline-secondary" href="{{ url_for('event_detail', slug=event.slug) }}">
    &larr; Back
  </a>
  <form method="post" action="{{ url_for('admin_reset_event_logs_by_event', event_id=event.id) }}"
        onsubmit="return confirm('Reset logs for this event?')">
    <button class="btn btn-outline-danger" type="submit">
      <i class="bi bi-trash"></i> Reset Logs
    </button>
  </form>
</div>

<div class="card shadow-sm">
  <div class="card-header d-flex align-items-center">
    <h5 class="mb-0"><i class="bi bi-list-check me-2"></i> Scan Activity</h5>
    <span class="ms-auto text-muted small">Total: {{ (logs or [])|length }}</span>
  </div>
  <div class="card-body">
    {% if logs and logs|length %}
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th>UID</th>
              <th>Reg Number</th>
              <th>Access</th>
              <th>Notes</th>
              <th>Scanned At</th>
            </tr>
          </thead>
          <tbody>
            {% for log in logs %}
            <tr>
              <td>{{ log.id }}</td>
              <td><code class="text-primary">{{ log.uid }}</code></td>
              <td><span class="badge bg-secondary">{{ log.reg_number or 'N/A' }}</span></td>
              <td>
                {% if log.status == 'ok' %}
                  <span class="badge bg-success"><i class="bi bi-check-circle"></i> Granted</span>
                {% else %}
                  <span class="badge bg-danger"><i class="bi bi-x-circle"></i> Denied</span>
                {% endif %}
              </td>
              <td>
                {% if log.notes %}
                  <span class="badge bg-light text-dark">{{ log.notes }}</span>
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
              <td class="nowrap">
                <small class="text-muted">
                  {{ log.scanned_at[:19].replace('T',' ') if log.scanned_at else 'N/A' }}
                </small>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-center py-5 text-muted">
        <i class="bi bi-clipboard-x display-1 d-block mb-2"></i>
        <h4>No event scans yet</h4>
        <p>Scans for this event will appear here as they happen.</p>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
